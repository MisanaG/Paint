<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paint con esteroides</title>
    <link rel="stylesheet" href="style.css">
    <script src="javascript/funciones.js"></script>
</head>
<body>
    <h1>Paint</h1>

    <div class="menu">
        <button id="lapiz" name="lapiz"><img src="img/lapiz.png" alt="Dibujar"></button>
        <button id="linea" name="linea"><img src="img/linea.png" alt="Dibujar lÃ­nea"></button>
        <button id="lineaB" name="lineaB"><img src="img/linea2.png" alt="Dibujar Bresenham"></button>
        <button id="lineaDDA" name="lineaDDA"><img src="img/linea3.png" alt="Dibujar DDA"></button>
        <button id="cuadrado" name="cuadrado"><img src="img/cuadrado.png" alt="Dibujar Cuadrado"></button>
        <button id="rectangulo" name="rectangulo"><img src="img/rectangulo.png" alt="Dibujar Rectangulo"></button>
        <button id="rombo" name="rombo"><img src="img/rombo.png" alt="Dibujar Rombo"></button>
        <button id="circuloB" name="circuloB"><img src="img/circulo.png" alt="Dibujar Circulo"></button>
        <button id="poligonoRInput" name="poligonoRInput"><img src="img/poligonoR.png" alt="Dibujar Poligono regular"></button>
        <button id="elipse" name="elipse"><img src="img/elipse.png" alt="Dibujar Elipse"></button>

        <button id="relleno" name="relleno"><img src="img/balde.png" alt="Rellenar Dibujo"></button>

        <button id="ctrlz" name="ctrlz"><img src="img/deshacer.png" alt="CTRL+Z"></button>
        <button id="ctrly" name="ctrly"><img src="img/rehacer.png" alt="CTRL+Y"></button>

    </div>

    <canvas id="Canvas" width="1200" height="450" style="border:1px solid #000000;"></canvas>

    <div class="input" id="inputPoligono" style="display: none;">
        <label>Ingrese el numero de lados: </label><br><input type="number" name="numlados" id="numlados">
        <button id="poligonoR" name="poligonoR">Dibujar</button>
    </div>
    <div class="input" id="inputRelleno" style="display: none;">
        <label>Selecciona un color: </label><br><input type="color" id="Rcolor" name="Rcolor" value="#ff0000">
        <button id="rellenar" name="rellenar">Dibujar</button>
    </div>
    
</body>

<script>

    //GUARDAR EL ELEMENTO Y EL CONTEXTO
    const mainCanvas = document.getElementById("Canvas");
    const context = mainCanvas.getContext("2d");

    //PILA
    let pila1 = new PilaFiguras();
    let pila2 = new PilaFiguras();

    //PUNTOS DE LA GRAFICA
    let PtInicio = {x: 0, y: 0};
    let PtFinal = {x: 0, y: 0};

    var PriClick = true;
    var Poligono = false;
    var Elipse = false;
    var Circulo = false;
    var LineaBre = false;
    var LineaBase = false;
    var LineaDDAs = false;
    var Cuadrado = false;
    var Dibujar = false;
    var Rectangulo = false;
    var Rombo = false;
    var Rellenar = false;


    mainCanvas.addEventListener("click", function(event){
        //OBTENER COORDENADAS
        var  rect = mainCanvas.getBoundingClientRect();
        var mouseX = event.clientX - rect.left;
        var mouseY = event.clientY - rect.top;

        //DIBUJAR PRIMER PUNTO
        if (PriClick){
            PtInicio.x = mouseX;
            PtInicio.y = mouseY;
            PriClick = false;
        }else {
            PtFinal.x = mouseX;
            PtFinal.y = mouseY;
            if (Elipse == true){
                radioX = Math.abs(PtFinal.x - PtInicio.x);
                radioY = Math.abs(PtFinal.y - PtInicio.y);
                DibujarElipse(PtInicio.x, PtInicio.y, radioX, radioY);
            }else if(Poligono == true){
                radio = Math.sqrt(Math.pow(PtFinal.x - PtInicio.x, 2) + Math.pow(PtFinal.y - PtInicio.y, 2));
                var inputNumeroLados = document.getElementById("numlados");
                lados = inputNumeroLados.value;
                PoligonoRegular(PtInicio.x, PtInicio.y, radio, lados);
            }else if(Circulo == true){
                radio = Math.sqrt(Math.pow(PtFinal.x - PtInicio.x, 2) + Math.pow(PtFinal.y - PtInicio.y, 2));
                CirculoBresenham(PtInicio.x, PtInicio.y, radio);
            }else if(Cuadrado == true){
                DibujarCuadrado(PtInicio.x, PtInicio.y, PtFinal.x, PtFinal.y);
                //GUARDAR LOS DATOS DE LA FIGURA EN LA PILA
                let figurax = new Figura ("cuadrado",PtInicio.x, PtInicio.y, PtFinal.x, PtFinal.y)
                pila1.push(figurax);
                //console.log("Elemento superior de la pila:", pila1.peek());
            }else if(LineaDDAs == true){
                LineaDDA(PtInicio.x, PtInicio.y, PtFinal.x, PtFinal.y);
            }else if(LineaBre == true){
                LineaBresenham(PtInicio.x, PtInicio.y, PtFinal.x, PtFinal.y);
            }else if(LineaBase == true){
                DibujarLinea(PtInicio.x, PtInicio.y, PtFinal.x, PtFinal.y);
            }else if(Dibujar == true){
                //FALTA AGREGAR ESTE
            }else if(Rectangulo == true){
                DibujarRectangulo(PtInicio.x, PtInicio.y, PtFinal.x, PtFinal.y);
            }else if(Rombo == true){
                radio = Math.sqrt(Math.pow(PtFinal.x - PtInicio.x, 2) + Math.pow(PtFinal.y - PtInicio.y, 2));
                lados = 4;
                PoligonoRegular(PtInicio.x, PtInicio.y, radio, lados);
            }

            

            //REINICIO DE VARIABLES
            PtInicio = {x: 0, y: 0};
            PtFinal = {x: 0, y: 0};
            PriClick = true;
        }
    });

    document.getElementById('lapiz').addEventListener('click', function () {
        Dibujar = true;
    });
    document.getElementById('linea').addEventListener('click', function () {
        cancelar()
        LineaBase = true;
    });
    document.getElementById('lineaB').addEventListener('click', function () {
        cancelar()
        LineaBre = true;
    });
    document.getElementById('lineaDDA').addEventListener('click', function () {
        cancelar()
        LineaDDAs = true;
    });
    document.getElementById('cuadrado').addEventListener('click', function () {
        cancelar()
        Cuadrado = true;
    });
    document.getElementById('circuloB').addEventListener('click', function () {
        cancelar()
        Circulo = true;
    });
    document.getElementById('poligonoRInput').addEventListener('click', function () {
        document.getElementById('inputPoligono').style.display = 'block';
    });
    document.getElementById('poligonoR').addEventListener('click', function () {
        cancelar()
        Poligono = true;
        document.getElementById('inputPoligono').style.display = 'none';
    });
    document.getElementById('elipse').addEventListener('click', function () {
        cancelar()
        Elipse = true;
    });
    document.getElementById('rectangulo').addEventListener('click', function () {
        cancelar()
        Rectangulo = true;
    });
    document.getElementById('rombo').addEventListener('click', function () {
        cancelar()
        Rombo = true;
    });
    document.getElementById('ctrlz').addEventListener('click', function () {
        //console.log("Elemento superior de la pila a borrar:", pila1.peek());
        let top = pila1.peek();
        if (top.tipo == "cuadrado"){
            BorrarFigura(top.co.x1, top.co.y1, top.co.x2, top.co.y2);
            //COLOCAR EN LA OTRA PILA
            let figurax = new Figura ("cuadrado", top.co.x1, top.co.y1, top.co.x2, top.co.y2)
            pila2.push(figurax);
            //console.log("Elemento superior de la pila de rehacer:", pila2.peek());
        }
        //SACAR DE LA PILA
        pila1.pop();
    });
    document.getElementById('ctrly').addEventListener('click', function () {
        //console.log("Elemento superior de la pila a redibujar:", pila2.peek());
        let top = pila2.peek();
        if (top.tipo == "cuadrado"){
            DibujarCuadrado(top.co.x1, top.co.y1, top.co.x2, top.co.y2);
            let figurax = new Figura ("cuadrado",top.co.x1, top.co.y1, top.co.x2, top.co.y2)
            pila1.push(figurax);
        }
        //SACAR DE LA PILA
        pila2.pop();
    });
    document.getElementById('relleno').addEventListener('click', function () {
        document.getElementById('inputRelleno').style.display = 'block';
    });
    document.getElementById('rellenar').addEventListener('click', function () {
        cancelar()
        Rellenar = true;
        document.getElementById('inputRelleno').style.display = 'none';
    });
</script>

</html>
